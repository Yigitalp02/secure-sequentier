version: '3.8'

services:
  backend:
    build:
      context: .
      dockerfile: SecureSolution2/Dockerfile
    container_name: secure-sequentier-backend
    restart: unless-stopped
    ports:
      - "9999:9999"
    volumes:
      - ./data/watch:/app/data/watch
      - ./data/queue:/app/data/queue
      - ./data/processed:/app/data/processed
      - ./data/logs:/app/data/logs
      - ./SecureSolution2/DefaultConfig.json:/app/DefaultConfig.json:ro
      - ./subsystems:/app/subsystems:ro
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:9999
    networks:
      - secure-sequentier-network
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:9999/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  frontend:
    build:
      context: .
      dockerfile: Web/Dockerfile
    container_name: secure-sequentier-frontend
    restart: unless-stopped
    ports:
      - "5188:5188"
    depends_on:
      - backend
    volumes:
      - ./data/queue:/app/data/queue:ro
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:5188
      - BACKEND_API_URL=http://backend:9999
    networks:
      - secure-sequentier-network
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:5188 || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  secure-sequentier-network:
    driver: bridge

